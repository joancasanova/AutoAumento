{
    "steps":[
       {
          "type":"parse",
          "parameters":{
             "text":"Tenemos 3 'almejas' y 4 'gambas'",
             "rules":[
                {
                   "name":"numero",
                   "pattern":"(\\d+)",
                   "mode":"regex",
                   "fallback_value":"numero_no_encontrado"
                },
                {
                   "name":"animal",
                   "pattern":"'",
                   "mode":"keyword",
                   "secondary_pattern":"'",
                   "fallback_value":"animal_no_encontrado"
                }
             ],
             "output_filter":"all"
          }
       },
       {
          "type":"parse",
          "parameters":{
             "text":"La 'perra' de la playa era muy rara. Tiene 3 -piernas-.\n La 'zorra' de la playa era muy rara. Tiene 3 -verdad-.",
             "rules":[
                {
                   "name":"perra",
                   "pattern":"'",
                   "mode":"keyword",
                   "secondary_pattern":"'",
                   "fallback_value":"perra_no_encontrado"
                },
                {
                   "name":"parte cuerpo",
                   "pattern":"-",
                   "mode":"keyword",
                   "secondary_pattern":"-",
                   "fallback_value":"parte_cuerpo_no_encontrado"
                }
             ],
             "output_filter":"successful"
          }
       },
       {
          "type":"generate",
          "parameters":{
             "system_prompt":"Eres una {perra} que analiza textos y responde con un breve comentario.",
             "user_prompt":"Genera un comentario divertido sobre {text}, {animal}, {parte cuerpo} y el {numero}.",
             "num_sequences":1,
             "max_tokens":10,
             "temperature":0.7
          },
          "uses_reference":true,
          "reference_step_numbers":[
             0,
             1
          ]
       },
       {
          "type":"parse",
          "parameters":{
             "rules":[
                {
                   "name":"texto_parseado",
                   "pattern":"(.*)",
                   "mode":"regex",
                   "fallback_value":"sin texto"
                }
             ],
             "output_filter":"first_n",
             "output_limit":1
          },
          "uses_reference":true,
          "reference_step_numbers":[
             2
          ]
       },
       {
          "type":"generate",
          "parameters":{
             "system_prompt":"Analiza textos y responde con un breve comentario.",
             "user_prompt":"Genera un comentario divertido sobre {texto_parseado}, {text}",
             "num_sequences":1,
             "max_tokens":10,
             "temperature":0.7
          },
          "uses_reference":true,
          "reference_step_numbers":[
             3
          ]
       }
    ],
    "global_references":{
       "text":"manzana"
    }
}